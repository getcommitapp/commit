@startuml architecture
title commit. - High-Level Architecture (Cloudflare Backend)

skinparam componentStyle rectangle
skinparam shadowing false
skinparam defaultTextAlignment center
skinparam wrapWidth 200
skinparam dpi 180
skinparam ArrowColor #555555
skinparam ArrowThickness 1
skinparam monochrome false

legend left
  commit. MVP Architecture
  - Mobile: Expo React Native (iOS/Android)
  - Web: Astro static site on Cloudflare Workers
  - Backend: Cloudflare (D1, R2, Workers: Auth, Business Logic)
  - Payments: Stripe
endlegend

rectangle "Users" as Users {
  actor "Mobile User" as MobileUser
  actor "Reviewer" as Reviewer
  actor "Admin" as Admin
}

package "Mobile App\nExpo React Native" as Mobile {
  [App Shell\n(Router, Tabs, Screens)] as AppShell
  [Auth SDK\n(Custom / OAuth via Workers)] as MobileAuth
  [API Client\n(Worker APIs)] as MobileApi
  [Storage Client\n(R2 Uploads/Downloads)] as MobileStorage
  [Stripe SDK\n(Payment methods, intents)] as MobileStripe
}

package "Web Landing\nAstro (Static)" as Web {
  [Static Pages]
  [Contact/Links]
}

node "Cloudflare Workers\n(Global CDN)" as CF
Web -down-> CF : deploy static site

package "Cloudflare Backend" as Cloudflare {
  database "D1 Database" as DB
  node "R2 Storage\n(Images)" as Storage
  node "Workers" as Edge {
    [Auth Logic] as Auth
    [Business Logic] as BizLogic
  }
}

cloud Stripe

MobileUser --> AppShell
Reviewer --> AppShell
Admin --> AppShell

AppShell --> MobileAuth
AppShell --> MobileApi
AppShell --> MobileStorage
AppShell --> MobileStripe

MobileAuth --> Auth : OAuth (Google/Apple)
MobileStorage --> BizLogic : photo uploads
MobileApi --> BizLogic : business logic / verification

MobileStripe -right-> Stripe : setup/capture payments

BizLogic --> DB : read/write
BizLogic --> Storage : signed URLs
Auth --> DB : user profiles

queue "Logs/Monitoring" as Observability
Edge -[#gray,dashed]-> Observability

note right of DB
  Entities:
  - Users, Profiles
  - Goals, GoalVerifications
  - Groups, GroupMembers
  - Stakes, Payments
  - Invitations
end note

note bottom of BizLogic
  Implements:
  - Goal resolution & payouts
  - Group distribution logic
  - Signed URL issuance
end note



note bottom of MobileStripe
  - Create/setup payment method
  - Authorize stake on goal creation
  - Capture on failure
  - Redistribute stake
end note

@enduml
